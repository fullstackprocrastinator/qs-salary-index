<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit Salary – The QS Salary Index</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon" />
  <style>
    .submit-form { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin: 2rem 0; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { margin-bottom: 0.5rem; font-weight: 600; color: #374151; }
    .form-group input, .form-group select, .form-group textarea {
      padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; background: white;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none; border-color: #1e40af; box-shadow: 0 0 0 3px rgba(30,64,175,0.1);
    }
    .nested-field { margin-top: 1rem; display: none; }
    .nested-field.active { display: block; }
    .submit-btn { background: #1e40af; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; font-size: 1rem; transition: background 0.2s; }
    .submit-btn:hover { background: #1e3a8a; }
    .submit-btn:disabled { background: #9ca3af; cursor: not-allowed; }
    .success-msg, .error-msg { padding: 1rem; border-radius: 8px; margin: 1rem 0; display: none; }
    .success-msg { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }
    .error-msg { background: #fef2f2; color: #991b1b; border: 1px solid #fca5a5; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container header-flex">
      <a href="/" class="logo-link">
        <img src="assets/img/qs-salary-index-logo.png" alt="The QS Salary Index Logo" class="logo">
        <span class="sr-only">The QS Salary Index</span>
      </a>
      <div class="header-text">
        <p>Live global salary data for Quantity Surveyors</p>
        <p class="brand-link">
          Part of <a href="https://www.theqscollection.com" target="_blank" rel="noopener">The QS Collection</a>
        </p>
        <nav>
          <a href="/">Index</a> |
          <a href="submit.html">Submit</a> |
          <a href="insights.html">Insights</a> |
          <a href="#" onclick="openEmail()">Contact</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <section class="hero">
      <h1>Submit Your Salary (100% Anonymous)</h1>
      <p>Your data helps thousands. All entries are reviewed before going live.</p>
    </section>

    <form id="salaryForm" class="submit-form">
      <div class="form-grid">
        <!-- Title/Role -->
        <div class="form-group">
          <label for="title">Title/Role *</label>
          <select id="title" required>
            <option value="">Select Role...</option>
            <option>Trainee QS</option>
            <option>Assistant QS</option>
            <option>QS</option>
            <option>Senior QS</option>
            <option>Principal QS</option>
            <option>Commercial Manager</option>
            <option>Cost Manager</option>
            <option>Project QS</option>
            <option>MEP QS</option>
            <option>Claims QS</option>
            <option>Other</option>
          </select>
          <input type="text" id="titleOther" class="other-input" placeholder="Enter your role..." style="display:none; margin-top:0.5rem;" />
        </div>

        <!-- QS Type -->
        <div class="form-group">
          <label for="qsType">QS Type *</label>
          <select id="qsType" required>
            <option value="">Select Type...</option>
            <option>Main Contractor</option>
            <option>Subcontractor</option>
            <option>Consultant</option>
            <option>Client / Developer</option>
          </select>
        </div>

        <!-- Country -->
        <div class="form-group">
          <label for="country">Country *</label>
          <select id="country" required>
            <option value="">Select Country...</option>
            <option>United Kingdom</option>
            <option>United States</option>
            <option>Australia</option>
            <option>Canada</option>
            <option>Ireland</option>
            <option>Other</option>
          </select>
        </div>

        <!-- UK Sub-Region -->
        <div class="form-group nested-field" id="ukSubField">
          <label for="ukSub">UK Region *</label>
          <select id="ukSub">
            <option value="">Select...</option>
            <option value="england">England</option>
            <option value="scotland">Scotland</option>
            <option value="wales">Wales</option>
          </select>
        </div>

        <!-- England County -->
        <div class="form-group nested-field" id="englandField">
          <label for="englandCounty">County (optional)</label>
          <select id="englandCounty">
            <option value="">Select County...</option>
            <!-- Populated by JS -->
          </select>
        </div>

        <!-- Scotland Council Area -->
        <div class="form-group nested-field" id="scotlandField">
          <label for="scotlandRegion">Council Area (optional)</label>
          <select id="scotlandRegion">
            <option value="">Select Area...</option>
            <!-- Populated by JS -->
          </select>
        </div>

        <!-- Wales Principal Area -->
        <div class="form-group nested-field" id="walesField">
          <label for="walesRegion">Principal Area (optional)</label>
          <select id="walesRegion">
            <option value="">Select Area...</option>
            <!-- Populated by JS -->
          </select>
        </div>

        <!-- US State -->
        <div class="form-group nested-field" id="usaField">
          <label for="state">State *</label>
          <select id="state" required>
            <option value="">Select State...</option>
            <!-- Populated by JS -->
          </select>
        </div>

        <!-- City (All Countries) -->
        <div class="form-group nested-field" id="cityField">
          <label id="cityLabel">City *</label>
          <input type="text" id="cityInput" placeholder="e.g. London" required />
        </div>

        <!-- Salary Range -->
        <div class="form-group">
          <label for="salary">Salary Range (GBP) *</label>
          <select id="salary" required>
            <option value="">Select Range...</option>
            <option>£30,000 - £40,000</option>
            <option>£40,000 - £50,000</option>
            <option>£50,000 - £60,000</option>
            <option>£60,000 - £70,000</option>
            <option>£70,000 - £80,000</option>
            <option>£80,000 - £90,000</option>
            <option>£90,000 - £100,000</option>
            <option>£100,000 - £120,000</option>
            <option>£120,000+</option>
          </select>
        </div>

        <!-- Time in Role -->
        <div class="form-group">
          <label for="timeInRole">Time in Role (years) *</label>
          <input type="number" id="timeInRole" min="0" max="50" step="0.5" placeholder="e.g. 3.5" required />
        </div>

        <!-- Education -->
        <div class="form-group">
          <label for="education">QS Education</label>
          <select id="education">
            <option>None</option>
            <option>HNC/HND</option>
            <option>BSc</option>
            <option>MSc</option>
            <option>PhD</option>
          </select>
        </div>

        <!-- Sector -->
        <div class="form-group">
          <label for="sector">Sector (optional)</label>
          <select id="sector">
            <option>Construction</option>
            <option>Infrastructure</option>
            <option>Oil & Gas</option>
            <option>Renewables</option>
            <option>Other</option>
          </select>
        </div>

        <!-- Company Size -->
        <div class="form-group">
          <label for="companySize">Company Size (optional)</label>
          <select id="companySize">
            <option>1-10</option>
            <option>11-50</option>
            <option>51-200</option>
            <option>201-500</option>
            <option>500+</option>
          </select>
        </div>

        <!-- Work Arrangement -->
        <div class="form-group">
          <label for="workArrangement">Work Arrangement (optional)</label>
          <select id="workArrangement">
            <option>On-site</option>
            <option>Hybrid</option>
            <option>Remote</option>
          </select>
        </div>

        <!-- Certification -->
        <div class="form-group">
          <label for="certification">Certification (optional)</label>
          <input type="text" id="certification" placeholder="e.g. MRICS, CIOB" />
        </div>
      </div>

      <!-- Benefits -->
      <div class="form-group">
        <label for="benefits">Bonus / Benefits (optional)</label>
        <textarea id="benefits" rows="3" placeholder="e.g. car allowance, pension, 30 days"></textarea>
      </div>

      <button type="submit" class="submit-btn">Submit for Approval</button>

      <div id="submitMsg"></div>
    </form>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <p>
        &copy; 2025 The QS Salary Index. 
        <a href="privacy.html">Privacy</a> | 
        <a href="terms.html">Terms</a> | 
        Part of <a href="https://www.theqscollection.com" target="_blank" rel="noopener">The QS Collection</a>
      </p>
    </div>
  </footer>

  <!-- CONFIG & JS -->
  <script>
  function openEmail() {
    const email = 'theqssalaryindex@outlook.com';
    const subject = encodeURIComponent('QS Salary Index – Submission Query');
    const body = encodeURIComponent('Hi,\n\nI have a question about my submission:\n\n[Your message]\n\nThanks!');
    window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
  }

  // Title "Other" handling
  const titleSelect = document.getElementById('title');
  const titleOther = document.getElementById('titleOther');
  titleSelect.addEventListener('change', () => {
    titleOther.style.display = titleSelect.value === 'Other' ? 'block' : 'none';
    titleOther.required = titleSelect.value === 'Other';
  });

  // Country → Region → City Logic
  const countrySel = document.getElementById('country');
  const ukSubField = document.getElementById('ukSubField');
  const ukSubSel = document.getElementById('ukSub');
  const englandField = document.getElementById('englandField');
  const scotlandField = document.getElementById('scotlandField');
  const walesField = document.getElementById('walesField');
  const usaField = document.getElementById('usaField');
  const cityField = document.getElementById('cityField');
  const cityInput = document.getElementById('cityInput');

  function setRequired(el, req) { if (el) el.required = req; }

  function resetAll() {
    [ukSubField, englandField, scotlandField, walesField, usaField].forEach(el => {
      el.classList.remove('active');
    });
    setRequired(cityInput, false);
    setRequired(ukSubSel, false);
    setRequired(document.getElementById('state'), false);

    ukSubSel.value = '';
    ['englandCounty', 'scotlandRegion', 'walesRegion', 'state'].forEach(id => {
      const sel = document.getElementById(id);
      if (sel) sel.innerHTML = '<option value="">Select (optional)...</option>';
    });
  }

  countrySel.addEventListener('change', () => {
    resetAll();
    const country = countrySel.value;
    if (!country) return;

    cityField.classList.add('active');
    setRequired(cityInput, true);

    if (country === 'United Kingdom') {
      ukSubField.classList.add('active');
      setRequired(ukSubSel, true);
    } else if (country === 'United States') {
      usaField.classList.add('active');
      populateSelect('state', CONFIG.USA_STATES);
      setRequired(document.getElementById('state'), true);
    }
  });

  ukSubSel.addEventListener('change', () => {
    [englandField, scotlandField, walesField].forEach(el => el.classList.remove('active'));
    setRequired(document.getElementById('englandCounty'), false);
    setRequired(document.getElementById('scotlandRegion'), false);
    setRequired(document.getElementById('walesRegion'), false);

    const sub = ukSubSel.value;
    if (sub === 'england') {
      englandField.classList.add('active');
      populateSelect('englandCounty', CONFIG.UK_COUNTIES);
    } else if (sub === 'scotland') {
      scotlandField.classList.add('active');
      populateSelect('scotlandRegion', CONFIG.SCOTLAND_COUNCIL_AREAS);
    } else if (sub === 'wales') {
      walesField.classList.add('active');
      populateSelect('walesRegion', CONFIG.WALES_PRINCIPAL_AREAS);
    }
  });

  function populateSelect(id, items = []) {
    const sel = document.getElementById(id);
    if (!sel) return;
    sel.innerHTML = '<option value="">Select (optional)...</option>';
    items.forEach(item => sel.appendChild(new Option(item, item)));
  }

  // Form Submit
  document.getElementById('salaryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = e.target.querySelector('.submit-btn');
    const msg = document.getElementById('submitMsg');
    btn.disabled = true;
    btn.textContent = 'Submitting...';
    msg.innerHTML = '';

    const title = titleSelect.value === 'Other' ? titleOther.value.trim() : titleSelect.value;
    const country = countrySel.value;
    const city = cityInput.value.trim();

    if (!title || !country || !city) {
      showError('Please fill all required fields.');
      btn.disabled = false; btn.textContent = 'Submit for Approval'; return;
    }

    let region = '';
    if (country === 'United Kingdom') {
      const sub = ukSubSel.value;
      if (!sub) { showError('Select England, Scotland, or Wales.'); btn.disabled = false; btn.textContent = 'Submit for Approval'; return; }
      region = sub === 'england' ? document.getElementById('englandCounty').value :
               sub === 'scotland' ? document.getElementById('scotlandRegion').value :
               document.getElementById('walesRegion').value;
    } else if (country === 'United States') {
      region = document.getElementById('state').value;
      if (!region) { showError('Please select a state.'); btn.disabled = false; btn.textContent = 'Submit for Approval'; return; }
    }

    const data = {
      title, qsType: document.getElementById('qsType').value, country, region, city,
      salary: document.getElementById('salary').value, timeInRole: document.getElementById('timeInRole').value,
      education: document.getElementById('education').value, sector: document.getElementById('sector').value || '',
      companySize: document.getElementById('companySize').value || '', workArrangement: document.getElementById('workArrangement').value || '',
      certification: document.getElementById('certification').value.trim() || '', benefits: document.getElementById('benefits').value.trim() || '',
      submittedAt: new Date().toISOString()
    };

    try {
      const formData = new URLSearchParams();
      formData.append('_subject', `New QS Salary – ${data.title} in ${data.city}`);
      formData.append('data', JSON.stringify(data, null, 2));
      Object.keys(data).forEach(k => formData.append(k, data[k]));

      const resp = await fetch(CONFIG.FORMSPREE_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: formData
      });

      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      showSuccess();
      e.target.reset();
      resetAll();
      titleOther.style.display = 'none';
    } catch (err) {
      showError(`Submission failed: ${err.message}`);
    } finally {
      btn.disabled = false;
      btn.textContent = 'Submit for Approval';
    }
  });

  function showSuccess() {
    document.getElementById('submitMsg').innerHTML = `<div class="success-msg">
      Thank you! Your submission has been received and will be reviewed within 24 hours.
    </div>`;
  }

  function showError(text) {
    document.getElementById('submitMsg').innerHTML = `<div class="error-msg">
      <strong>Error:</strong> ${text}
    </div>`;
  }
</script>
</body>
</html>
