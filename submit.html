<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit Salary – The QS Salary Index</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon" />
  <style>
    .submit-form { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin: 2rem 0; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { margin-bottom: 0.5rem; font-weight: 600; color: #374151; }
    .form-group input, .form-group select, .form-group textarea {
      padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; background: white;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none; border-color: #1e40af; box-shadow: 0 0 0 3px rgba(30,64,175,0.1);
    }
    .nested-field { margin-top: 1rem; display: none; }
    .nested-field.active { display: block; }
    .other-input { display: none; margin-top: 0.5rem; }
    .submit-btn { background: #1e40af; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; font-size: 1rem; transition: background 0.2s; }
    .submit-btn:hover { background: #1e3a8a; }
    .submit-btn:disabled { background: #9ca3af; cursor: not-allowed; }
    .msg { padding: 1rem; border-radius: 8px; margin: 1rem 0; font-size: 0.95rem; }
    .success-msg { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }
    .error-msg { background: #fef2f2; color: #991b1b; border: 1px solid #fca5a5; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container header-flex">
      <a href="/" class="logo-link">
        <img src="assets/img/qs-salary-index-logo.png" alt="The QS Salary Index Logo" class="logo">
        <span class="sr-only">The QS Salary Index</span>
      </a>
      <div class="header-text">
        <p>Live global salary data for Quantity Surveyors</p>
        <p class="brand-link">
          Part of <a href="https://www.theqscollection.com" target="_blank" rel="noopener">The QS Collection</a>
        </p>
        <nav>
          <a href="/">Index</a> |
          <a href="submit.html">Submit</a> |
          <a href="insights.html">Insights</a> |
          <a href="#" onclick="openEmail()">Contact</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <section class="hero">
      <h1>Submit Your Salary (100% Anonymous)</h1>
      <p>Your data helps thousands. All entries are reviewed before going live.</p>
    </section>

    <form id="salaryForm" class="submit-form">
      <div class="form-grid">
        <!-- Title/Role -->
        <div class="form-group">
          <label for="title">Title/Role *</label>
          <select id="title" required>
            <option value="">Select Role...</option>
            <option>Trainee QS</option>
            <option>Assistant QS</option>
            <option>QS</option>
            <option>Senior QS</option>
            <option>Principal QS</option>
            <option>Commercial Manager</option>
            <option>Cost Manager</option>
            <option>Project QS</option>
            <option>MEP QS</option>
            <option>Claims QS</option>
            <option>Other</option>
          </select>
          <input type="text" id="titleOther" class="other-input" placeholder="Enter your role..." />
        </div>

        <!-- QS Type -->
        <div class="form-group">
          <label for="qsType">QS Type *</label>
          <select id="qsType" required>
            <option value="">Select Type...</option>
            <option>Main Contractor</option>
            <option>Subcontractor</option>
            <option>Consultant</option>
            <option>Client / Developer</option>
          </select>
        </div>

        <!-- Country -->
        <div class="form-group">
          <label for="country">Country *</label>
          <select id="country" required>
            <option value="">Select Country...</option>
            <option>United Kingdom</option>
            <option>United States</option>
            <option>Australia</option>
            <option>Canada</option>
            <option>Ireland</option>
            <option>Other</option>
          </select>
        </div>

        <!-- UK Region -->
        <div class="form-group nested-field" id="ukRegionField">
          <label for="ukRegion">UK Region *</label>
          <select id="ukRegion">
            <option value="">Select...</option>
            <option value="england">England</option>
            <option value="scotland">Scotland</option>
            <option value="wales">Wales</option>
          </select>
        </div>

        <!-- England County -->
        <div class="form-group nested-field" id="englandCountyField">
          <label for="englandCounty">County (optional)</label>
          <select id="englandCounty">
            <option value="">Select County...</option>
          </select>
        </div>

        <!-- Scotland Council Area -->
        <div class="form-group nested-field" id="scotlandAreaField">
          <label for="scotlandArea">Council Area (optional)</label>
          <select id="scotlandArea">
            <option value="">Select Area...</option>
          </select>
        </div>

        <!-- Wales Principal Area -->
        <div class="form-group nested-field" id="walesAreaField">
          <label for="walesArea">Principal Area (optional)</label>
          <select id="walesArea">
            <option value="">Select Area...</option>
          </select>
        </div>

        <!-- US State -->
        <div class="form-group nested-field" id="usaStateField">
          <label for="usaState">State *</label>
          <select id="usaState">
            <option value="">Select State...</option>
          </select>
        </div>

        <!-- City -->
        <div class="form-group nested-field" id="cityField">
          <label for="city">City *</label>
          <input type="text" id="city" placeholder="e.g. London" required />
        </div>

        <!-- Salary Range -->
        <div class="form-group">
          <label for="salary">Salary Range (GBP) *</label>
          <select id="salary" required>
            <option value="">Select Range...</option>
            <option>£30,000 - £40,000</option>
            <option>£40,000 - £50,000</option>
            <option>£50,000 - £60,000</option>
            <option>£60,000 - £70,000</option>
            <option>£70,000 - £80,000</option>
            <option>£80,000 - £90,000</option>
            <option>£90,000 - £100,000</option>
            <option>£100,000 - £120,000</option>
            <option>£120,000+</option>
          </select>
        </div>

        <!-- Time in Role -->
        <div class="form-group">
          <label for="timeInRole">Time in Role (years) *</label>
          <input type="number" id="timeInRole" min="0" max="50" step="0.5" placeholder="e.g. 3.5" required />
        </div>

        <!-- Education -->
        <div class="form-group">
          <label for="education">QS Education</label>
          <select id="education">
            <option>None</option>
            <option>HNC/HND</option>
            <option>BSc</option>
            <option>MSc</option>
            <option>PhD</option>
          </select>
        </div>

        <!-- Sector -->
        <div class="form-group">
          <label for="sector">Sector (optional)</label>
          <select id="sector">
            <option>Construction</option>
            <option>Infrastructure</option>
            <option>Oil & Gas</option>
            <option>Renewables</option>
            <option>Other</option>
          </select>
        </div>

        <!-- Company Size -->
        <div class="form-group">
          <label for="companySize">Company Size (optional)</label>
          <!--<select id="companySize">-->
          <select id="companySize">
            <option>1-10</option>
            <option>11-50</option>
            <option>51-200</option>
            <option>201-500</option>
            <option>500+</option>
          </select>
        </div>

        <!-- Work Arrangement -->
        <div class="form-group">
          <label for="workArrangement">Work Arrangement (optional)</label>
          <select id="workArrangement">
            <option>On-site</option>
            <option>Hybrid</option>
            <option>Remote</option>
          </select>
        </div>

        <!-- Certification -->
        <div class="form-group">
          <label for="certification">Certification (optional)</label>
          <input type="text" id="certification" placeholder="e.g. MRICS, CIOB" />
        </div>
      </div>

      <!-- Benefits -->
      <div class="form-group">
        <label for="benefits">Bonus / Benefits (optional)</label>
        <textarea id="benefits" rows="3" placeholder="e.g. car allowance, pension, 30 days"></textarea>
      </div>

      <button type="submit" class="submit-btn">Submit for Approval</button>

      <div id="submitMsg"></div>
    </form>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <p>
        &copy; 2025 The QS Salary Index. 
        <a href="privacy.html">Privacy</a> | 
        <a href="terms.html">Terms</a> | 
        Part of <a href="https://www.theqscollection.com" target="_blank" rel="noopener">The QS Collection</a>
      </p>
    </div>
  </footer>

  <!-- FINAL JS: NO CORS, NO REDIRECT, NO ERRORS -->
  <script>
    // === CONFIG (hardcoded) ===
    const CONFIG = {
      FORMSPREE_ENDPOINT: 'https://formspree.io/f/xnnlaqka',
      UK_COUNTIES: ["Bedfordshire","Berkshire","Bristol","Buckinghamshire","Cambridgeshire","Cheshire","Cornwall","Cumbria","Derbyshire","Devon","Dorset","Durham","East Sussex","Essex","Gloucestershire","Greater London","Greater Manchester","Hampshire","Hertfordshire","Kent","Lancashire","Leicestershire","Lincolnshire","Merseyside","Norfolk","North Yorkshire","Northamptonshire","Northumberland","Nottinghamshire","Oxfordshire","Shropshire","Somerset","South Yorkshire","Staffordshire","Suffolk","Surrey","Tyne and Wear","Warwickshire","West Midlands","West Sussex","West Yorkshire","Wiltshire","Worcestershire"].sort(),
      SCOTLAND_COUNCIL_AREAS: ["Aberdeen City","Aberdeenshire","Angus","Argyll and Bute","Clackmannanshire","Dumfries and Galloway","Dundee City","East Ayrshire","East Dunbartonshire","East Lothian","East Renfrewshire","Edinburgh","Eilean Siar","Falkirk","Fife","Glasgow City","Highland","Inverclyde","Midlothian","Moray","North Ayrshire","North Lanarkshire","Orkney Islands","Perth and Kinross","Renfrewshire","Scottish Borders","Shetland Islands","South Ayrshire","South Lanarkshire","Stirling","West Dunbartonshire","West Lothian"].sort(),
      WALES_PRINCIPAL_AREAS: ["Blaenau Gwent","Bridgend","Caerphilly","Cardiff","Carmarthenshire","Ceredigion","Conwy","Denbighshire","Flintshire","Gwynedd","Isle of Anglesey","Merthyr Tydfil","Monmouthshire","Neath Port Talbot","Newport","Pembrokeshire","Powys","Rhondda Cynon Taf","Swansea","Torfaen","Vale of Glamorgan","Wrexham"].sort(),
      USA_STATES: ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"].sort()
    };

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('salaryForm');
      const titleSelect = document.getElementById('title');
      const titleOther = document.getElementById('titleOther');
      const countrySel = document.getElementById('country');
      const ukRegionField = document.getElementById('ukRegionField');
      const ukRegionSel = document.getElementById('ukRegion');
      const englandCountyField = document.getElementById('englandCountyField');
      const scotlandAreaField = document.getElementById('scotlandAreaField');
      const walesAreaField = document.getElementById('walesAreaField');
      const usaStateField = document.getElementById('usaStateField');
      const cityField = document.getElementById('cityField');
      const cityInput = document.getElementById('city');
      const submitBtn = form.querySelector('.submit-btn');
      const msgDiv = document.getElementById('submitMsg');

      // Title Other
      titleSelect.addEventListener('change', () => {
        titleOther.style.display = titleSelect.value === 'Other' ? 'block' : 'none';
        titleOther.required = titleSelect.value === 'Other';
      });

      function resetAll() {
        [ukRegionField, englandCountyField, scotlandAreaField, walesAreaField, usaStateField].forEach(f => f.classList.remove('active'));
        setRequired(cityInput, false);
        setRequired(ukRegionSel, false);
        setRequired(document.getElementById('usaState'), false);
        ukRegionSel.value = '';
        ['englandCounty', 'scotlandArea', 'walesArea', 'usaState'].forEach(id => {
          const sel = document.getElementById(id);
          if (sel) sel.innerHTML = '<option value="">Select (optional)...</option>';
        });
      }

      function setRequired(el, req) { if (el) el.required = req; }

      countrySel.addEventListener('change', () => {
        resetAll();
        const country = countrySel.value;
        if (!country) return;

        cityField.classList.add('active');
        setRequired(cityInput, true);

        if (country === 'United Kingdom') {
          ukRegionField.classList.add('active');
          setRequired(ukRegionSel, true);
        } else if (country === 'United States') {
          usaStateField.classList.add('active');
          populateSelect('usaState', CONFIG.USA_STATES);
          setRequired(document.getElementById('usaState'), true);
        }
      });

      ukRegionSel.addEventListener('change', () => {
        [englandCountyField, scotlandAreaField, walesAreaField].forEach(f => f.classList.remove('active'));
        const region = ukRegionSel.value;
        if (region === 'england') {
          englandCountyField.classList.add('active');
          populateSelect('englandCounty', CONFIG.UK_COUNTIES);
        } else if (region === 'scotland') {
          scotlandAreaField.classList.add('active');
          populateSelect('scotlandArea', CONFIG.SCOTLAND_COUNCIL_AREAS);
        } else if (region === 'wales') {
          walesAreaField.classList.add('active');
          populateSelect('walesArea', CONFIG.WALES_PRINCIPAL_AREAS);
        }
      });

      function populateSelect(id, items = []) {
        const sel = document.getElementById(id);
        if (!sel) return;
        sel.innerHTML = '<option value="">Select (optional)...</option>';
        items.forEach(item => sel.appendChild(new Option(item, item)));
      }

      // === FORM SUBMIT: BULLETPROOF ===
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        msgDiv.innerHTML = '';

        const title = titleSelect.value === 'Other' ? titleOther.value.trim() : titleSelect.value;
        const country = countrySel.value;
        const city = cityInput.value.trim();

        if (!title || !country || !city) {
          showError('Please fill all required fields.');
          resetBtn();
          return;
        }

        let region = '';
        if (country === 'United Kingdom') {
          const sub = ukRegionSel.value;
          if (!sub) { showError('Select England, Scotland, or Wales.'); resetBtn(); return; }
          region = sub === 'england' ? document.getElementById('englandCounty').value :
                   sub === 'scotland' ? document.getElementById('scotlandArea').value :
                   document.getElementById('walesArea').value;
        } else if (country === 'United States') {
          region = document.getElementById('usaState').value;
          if (!region) { showError('Please select a state.'); resetBtn(); return; }
        }

        const data = {
          title, qsType: document.getElementById('qsType').value, country, region, city,
          salary: document.getElementById('salary').value, timeInRole: document.getElementById('timeInRole').value,
          education: document.getElementById('education').value, sector: document.getElementById('sector').value || '',
          companySize: document.getElementById('companySize').value || '', workArrangement: document.getElementById('workArrangement').value || '',
          certification: document.getElementById('certification').value.trim() || '', benefits: document.getElementById('benefits').value.trim() || '',
          submittedAt: new Date().toISOString()
        };

        try {
          const formData = new URLSearchParams();
          formData.append('_subject', `New QS Salary – ${data.title} in ${data.city}`);
          formData.append('data', JSON.stringify(data, null, 2));
          Object.keys(data).forEach(k => formData.append(k, data[k]));

          // CRITICAL: Prevent redirect
          formData.append('_next', '');

          const response = await fetch(CONFIG.FORMSPREE_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: formData,
            redirect: 'follow'
          });

          if (response.ok) {
            showSuccess();
            form.reset();
            resetAll();
            titleOther.style.display = 'none';
          } else {
            const text = await response.text();
            throw new Error(`Formspree error ${response.status}: ${text}`);
          }
        } catch (err) {
          console.error('Submit failed:', err);
          showError('Submission failed. Please try again or email us.');
        } finally {
          resetBtn();
        }
      });

      function showSuccess() {
        msgDiv.innerHTML = `<div class="msg success-msg">
          Thank you! Your submission has been received and will be reviewed within 24 hours.
        </div>`;
      }

      function showError(text) {
        msgDiv.innerHTML = `<div class="msg error-msg">
          <strong>Error:</strong> ${text}
        </div>`;
      }

      function resetBtn() {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit for Approval';
      }

      function openEmail() {
        window.location.href = 'mailto:theqssalaryindex@outlook.com?subject=QS%20Salary%20Index%20–%20Submission%20Issue&body=Hi,%0D%0A%0D%0AI%20tried%20to%20submit%20but%20got%20an%20error:%0D%0A%0D%0A[Describe%20issue]%0D%0A%0D%0AThanks!';
      }

      // AUTO-SELECT UK FOR GB USERS
      if (navigator.language.startsWith('en-GB')) {
        countrySel.value = 'United Kingdom';
        countrySel.dispatchEvent(new Event('change'));
      }
    });
  </script>
</body>
</html>
